<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Quadro de Status de Pedidos da Seoul Chicken</title>


    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <!-- FontAwesome ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ì‹œíŠ¸ë¥¼ ë¡œë“œ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>

        #dailyTotal, #monthlyTotal {
            margin-left: 20px;
            font-weight: bold;
            color: #333;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
                /* í…Œì´ë¸”ì„ í¬í•¨í•  ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ì„¤ì • */
        .table-container {
            display: flex; /* ê°€ë¡œë¡œ ë°°ì¹˜ */
            justify-content: space-between; /* ì—¬ë°± ì¡°ì • */
            align-items: flex-start; /* ìœ„ìª½ ì •ë ¬ */
            gap: 1%; /* í…Œì´ë¸” ê°„ ê°„ê²© */
        }

        /* ì™¼ìª½ í…Œì´ë¸” (40%) */
        #dataTable {
            width: 40%; /* ì™¼ìª½ í…Œì´ë¸” ë„ˆë¹„ */
            border-collapse: collapse;
            word-wrap: break-word;
            table-layout: fixed;
        }

        /* ì˜¤ë¥¸ìª½ í…Œì´ë¸” (60%) */
        #deliveryTable {
            width: 58%; /* ì˜¤ë¥¸ìª½ í…Œì´ë¸” ë„ˆë¹„ */
            border-collapse: collapse;
            word-wrap: break-word;
            table-layout: fixed;
        }
        th, td {
        text-align: center;
        border: 1px solid #ddd;
        padding: 4px; /* ê°„ê²©ì„ ì¤„ì„ */
        overflow-wrap: break-word;
        }

        th {
            background-color: #f4f4f4;
        }

        th:nth-child(5), td:nth-child(5) {
            width: 300px; /* Order List ì—´ì„ ë‹¤ë¥¸ í•„ë“œë³´ë‹¤ 3ë°° ë„“ê²Œ ì„¤ì • */
        }
        @media screen and (max-width: 768px) {
            table {
                width: 100%; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì „ì²´ í­ì„ ì°¨ì§€ */
                float: none; /* ì„¸ë¡œë¡œ ë°°ì¹˜ */
            }

            th, td {
                padding: 6px;
            }

            h1 {
                font-size: 20px;
            }

            button, label, select {
                font-size: 14px;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #printable {
                visibility: visible;
                position: absolute;
                left: 0;
                top: 0;
                font-size: 120%;
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <h1>Quadro de Status de Pedidos da Seoul Chicken</h1>
    <div id="numberButtons" style="margin-bottom: 10px; text-align: left;">
        <!-- 1ë²ˆë¶€í„° 10ë²ˆê¹Œì§€ ë²„íŠ¼ ìƒì„± -->
    <button style="margin: 0 5px;" onclick="showOrderDetails(0)">0</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(1)">1</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(2)">2</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(3)">3</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(4)">4</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(5)">5</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(6)">6</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(7)">7</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(8)">8</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(9)">9</button>
    <button style="margin: 0 5px;" onclick="showOrderDetails(10)">10</button>
    </div>

    <!-- ëª¨ë‹¬ ì¶”ê°€ -->
    <div id="orderModal" style="display: none; position: fixed; top: 20%; left: 50%; transform: translate(-50%, -20%); z-index: 1000; background: white; border: 1px solid #ddd; padding: 20px; border-radius: 10px; width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <h3 id="modalTitle">Table Details</h3>
        <div id="modalContent" style="margin: 20px 0;"></div>
        <label for="paymentMethod">ê²°ì œ ë°©ì‹:</label>
        <select id="paymentMethod">
            <option value="cash">í˜„ê¸ˆ</option>
            <option value="pix">Pix</option>
            <option value="card">ì¹´ë“œ</option>
        </select>
        <div style="text-align: right; margin-top: 20px;">
            <button onclick="printModal()">í”„ë¦°íŠ¸</button>
            <button onclick="submitPayment()">ê²°ì œ</button>
            <button onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
      function showOrderDetails(tableNumber) {
        const modal = document.getElementById('orderModal');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');
        const selectedDate = document.getElementById('dateFilter').value; // ì„ íƒëœ ë‚ ì§œ í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°

        modalTitle.textContent = `Table ${tableNumber} Details`;

        // Firebaseì—ì„œ í•´ë‹¹ í…Œì´ë¸” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
        const dbRef = firebase.database().ref('orders');
        dbRef.once('value', (snapshot) => {
            const data = snapshot.val();
            const tableOrders = Object.values(data || {}).filter(order => {
                const orderTableNumber = Number(order.tableNumber); // ë°ì´í„°ì˜ tableNumber
                const orderDate = new Date(order.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });

                // í…Œì´ë¸” ë²ˆí˜¸ì™€ ë‚ ì§œ í•„í„° ì¡°ê±´ í™•ì¸
                return orderTableNumber === tableNumber && // tableNumber ë§¤ì¹­
                    (selectedDate === 'all' || selectedDate === orderDate); // ë‚ ì§œ í•„í„° ë§¤ì¹­
            });

            if (tableOrders.length > 0) {
                // ì£¼ë¬¸ ëª©ë¡ê³¼ í•©ê³„ë¥¼ ê³„ì‚°
                let totalAmount = 0; // í•©ê³„ë¥¼ ì´ˆê¸°í™”
                const orderDetails = tableOrders.map(order => {
                    const formattedOrderList = Array.isArray(order.orderList)
                        ? order.orderList.map(item => `${item.quantity}x ${item.name}`).join('<br>') // ê° í•­ëª©ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„
                        : 'No orders found'; // orderListê°€ ë°°ì—´ì´ ì•„ë‹ ê²½ìš° ê¸°ë³¸ ë©”ì‹œì§€

                    // **ì´ì•¡ ê³„ì‚° (ë¬¸ìì—´ì—ì„œ ìˆ«ì ì¶”ì¶œ í›„ ë³€í™˜)**
                    const cleanAmount = parseFloat(String(order.totalAmount).replace(/[^0-9.-]+/g, '')) || 0;
                    totalAmount += cleanAmount; // ì •ë¦¬ëœ ê°’ì„ ëˆ„ì 

                    return `
                        <div style="margin-bottom: 20px;">
                            <p><strong>Order List:</strong></p>
                            <div style="border: 1px solid #ddd; padding: 10px;">
                                ${formattedOrderList}
                            </div>
                            <p><strong>Total Amount:</strong> ${order.totalAmount || '0'} ì›</p>
                        </div>
                    `;
                }).join('');

                // **ì´í•© ê³„ì‚° ê²°ê³¼ë¥¼ í•˜ë‹¨ì— ì¶”ê°€**
                const totalAmountHtml = `
                    <div style="margin-top: 20px; text-align: left; font-weight: bold; font-size: 16px;">
                        Total Amount (í•©ê³„): ${totalAmount.toLocaleString('ko-KR')} ì›
                    </div>
                `;

                // ëª¨ë‹¬ ë‚´ìš© êµ¬ì„±
                modalContent.innerHTML = `
                    ${orderDetails}
                    ${totalAmountHtml} <!-- ì¶”ê°€ëœ ì´í•© HTML -->
                `;
            } else {
                modalContent.innerHTML = '<p>No orders found for this table.</p>';
            }

            modal.style.display = 'block'; // ëª¨ë‹¬ ì—´ê¸°
        });
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal() {
        document.getElementById('orderModal').style.display = 'none';
    }

    // ëª¨ë‹¬ í”„ë¦°íŠ¸
    function printModal() {
  // ëª¨ë‹¬ ì œëª©(í…Œì´ë¸” ë²ˆí˜¸)ì„ ê°€ì ¸ì˜´
  const modalTitle = document.getElementById('modalTitle').textContent;

// ëª¨ë‹¬ ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì˜´
const modalContent = document.getElementById('modalContent').innerHTML;

// í”„ë¦°íŠ¸ ì°½ ì—´ê¸°
const printWindow = window.open('', '_blank', 'width=600,height=400');

// í”„ë¦°íŠ¸ ë‚´ìš© ì‘ì„±
printWindow.document.write(`
    <html>
    <head>
        <title>Print Receipt</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                padding: 0;
            }
            h3 {
                text-align: center;
            }
            p {
                margin: 5px 0;
            }
        </style>
    </head>
    <body>
        <h3>${modalTitle}</h3> <!-- í…Œì´ë¸” ë²ˆí˜¸ë¥¼ ìƒë‹¨ì— ì¶”ê°€ -->
        <div>${modalContent}</div> <!-- ëª¨ë‹¬ ë‚´ìš© ì¶”ê°€ -->
    </body>
    </html>
`);

printWindow.document.close(); // ë¬¸ì„œ ë‹«ê¸°
printWindow.print(); // ì¸ì‡„ ì‹¤í–‰
}
    
        // ê²°ì œ ì •ë³´ ì €ì¥
        function submitPayment() {
    const paymentMethod = document.getElementById('paymentMethod').value;
    const modalTitle = document.getElementById('modalTitle').textContent;
    const tableNumber = parseInt(modalTitle.replace('Table ', '').replace(' Details', ''), 10);

    // ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ë‹«ê¸° ì „ìš© í•¨ìˆ˜ í˜¸ì¶œ
    const passwordModal = document.getElementById('passwordModal');
    if (passwordModal) {
        alert('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ì´ ì—´ë ¤ìˆìŠµë‹ˆë‹¤. ê²°ì œë¥¼ ì§„í–‰í•˜ë ¤ë©´ ëª¨ë‹¬ì„ ë‹«ì•„ì£¼ì„¸ìš”.');
        return;
    }

    const dbRef = firebase.database().ref('orders');
    dbRef.once('value', (snapshot) => {
        const data = snapshot.val();
        const targetKey = Object.keys(data || {}).find(key => Number(data[key].tableNumber) === tableNumber);

        if (targetKey) {
            dbRef.child(targetKey).update({ paymentMethod }).then(() => {
                alert('ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                // í•´ë‹¹ í–‰ì˜ Payment ì…€ ì—…ë°ì´íŠ¸
                const rows = document.querySelectorAll('#dataTable tbody tr, #deliveryTable tbody tr');
                rows.forEach(row => {
                    const rowTableNumber = parseInt(row.children[3]?.textContent || '0', 10);
                    if (rowTableNumber === tableNumber) {
                        const paymentCell = row.children[7]; // Payment ì…€
                        paymentCell.textContent = paymentMethod;
                        paymentCell.style.backgroundColor = '#d0e7ff';
                    }
                });

                closeModal();
            }).catch((error) => {
                console.error('ê²°ì œ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
            });
        } else {
            alert('í•´ë‹¹ í…Œì´ë¸” ë²ˆí˜¸ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
    });
}
    </script>


    <label for="dateFilter">Filter by Date:</label>
    <select id="dateFilter">
        <option value="all">All Dates</option>
    </select>
    <button id="enableSoundButton">Click to Enable Sound</button>
    <!-- ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì¶”ê°€ -->
    <button id="downloadExcelButton">Download Excel</button>

    <span id="dailyTotal" style="margin-left: 20px; font-weight: bold;">ì¼ ë§¤ì¶œ: 0</span>
    <span id="monthlyTotal" style="margin-left: 20px; font-weight: bold;">ì›” ë§¤ì¶œ: 0</span>
    
    <script>
        // ì—‘ì…€ íŒŒì¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    function downloadExcel() {
        // í…Œì´ë¸” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        let tableData = [];
        const headers = ['Number', 'Date', 'Timestamp', 'Table Number', 'Order List', 'Qty', 'Total Amount'];
        tableData.push(headers); // ì²« ë²ˆì§¸ í–‰: í—¤ë”

        // í…Œì´ë¸”ì—ì„œ ë°ì´í„° ì½ê¸°
        allData.forEach((item, index) => {
            const data = item.data;
            const date = new Date(data.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            const time = new Date(data.timestamp).toLocaleTimeString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            const orderList = JSON.stringify(data.orderList)
                .replace(/[\[\]{}"]/g, '')
                .split(',')
                .join('\n'); // ì£¼ë¬¸ ëª©ë¡ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë³€í™˜
            const qty = (orderList.match(/"\d+"/g) || []).map(num => num.replace(/"/g, '')).join('\n'); // ìˆ˜ëŸ‰
            const rowData = [
                index + 1,
                date,
                time,
                data.tableNumber || '',
                orderList,
                qty,
                data.totalAmount || ''
            ];
            tableData.push(rowData);
        });

        // CSV í¬ë§·ìœ¼ë¡œ ë³€í™˜
        const csvContent = tableData
            .map(row => row.map(field => `"${field}"`).join(','))
            .join('\r\n');

        // UTF-8 BOM ì¶”ê°€
        const utf8Bom = '\uFEFF'; // UTF-8 BOM (Byte Order Mark)
        const finalCsvContent = utf8Bom + csvContent;

        // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
        const blob = new Blob([finalCsvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'SeoulChickenOrders.csv'; // íŒŒì¼ëª… ì§€ì •
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.getElementById('downloadExcelButton').addEventListener('click', downloadExcel);

    </script>
<div class="table-container">
    <!-- ì™¼ìª½ í…Œì´ë¸” -->
    <table id="dataTable" border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>No</th>
                <th>Data</th>
                <th>Tempo</th>
                <th>Mesa</th>
                <th>Pedidos</th>
                <th>Qty</th>
                <th>Valor</th>
                <th>Payment</th> <!-- ì¶”ê°€ëœ í•„ë“œ -->
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ì˜¤ë¥¸ìª½ìª½: ë°°ë‹¬ ì „ìš© í…Œì´ë¸” -->
    <table id="deliveryTable" border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>No</th>
                <th>Data</th>
                <th>Tempo</th>
                <th>Mesa</th>
                <th>Pedidos</th>
                <th>Qty</th>
                <th>Valor</th>
                <th>Nome</th>
                <th>Celu.</th>
                <th>EndereÃ§o</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Notification Sound -->
    <audio id="notificationSound" src="notification.mp3" preload="auto"></audio>

    <!-- ì¸ì‡„í•  ë‚´ìš©ì„ ë‹´ëŠ” ìˆ¨ê²¨ì§„ ì˜ì—­ -->
    <div id="printable" style="display:none;"></div>

    <script>
        // Firebase ì„¤ì • ì •ë³´ (Firebase ì½˜ì†”ì—ì„œ ê°€ì ¸ì˜¨ ì •ë³´ë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•˜ì„¸ìš”)
        const firebaseConfig = {
            apiKey: "AIzaSyBltwkIkocgAMya7_lKglLVikl9dIzegoI",
            authDomain: "seoulchicken-fa390.firebaseapp.com",
            databaseURL: "https://seoulchicken-fa390-default-rtdb.firebaseio.com",
            projectId: "seoulchicken-fa390",
            storageBucket: "seoulchicken-fa390.appspot.com",
            messagingSenderId: "159382576680",
            appId: "1:159382576680:web:8d5440ea41ba4cb89d9f1d",
            measurementId: "G-FRCNM1T9JB"
        };

        // Firebase ì´ˆê¸°í™”
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        const dateFilter = document.getElementById('dateFilter'); // ë‚ ì§œ í•„í„° ë“œë¡­ë‹¤ìš´
        const tableBody = document.querySelector('#dataTable tbody'); // í…Œì´ë¸” ë°”ë””
        const deliveryTableBody = document.querySelector('#deliveryTable tbody'); // ì˜¤ë¥¸ìª½ í…Œì´ë¸” ë°”ë””
        const notificationSound = document.getElementById('notificationSound'); // ì•Œë¦¼ ì†Œë¦¬
        const enableSoundButton = document.getElementById('enableSoundButton'); // ì†Œë¦¬ í™œì„±í™” ë²„íŠ¼

        let soundEnabled = false; // ì†Œë¦¬ ì¬ìƒ ê°€ëŠ¥ ì—¬ë¶€
        let count = 1; // ë°ì´í„° ë²ˆí˜¸ë¥¼ ê¸°ë¡í•˜ê¸° ìœ„í•œ ì¹´ìš´í„°
        let allData = []; // ëª¨ë“  ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´


        window.onload = function() {
    const passwords = ["Ji1213k", "4321"]; // í—ˆìš©í•  ë¹„ë°€ë²ˆí˜¸ ëª©ë¡

    // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ ìƒì„±
    const passwordModal = document.createElement("div");
    passwordModal.id = "passwordModal";
    passwordModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    `;

    // ëª¨ë‹¬ ë‚´ìš© êµ¬ì„±
    passwordModal.innerHTML = `
        <div style="
            background: #ffffff; 
            padding: 30px 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); 
            text-align: center; 
            max-width: 350px; 
            width: 90%;
        ">
            <h2 style="
                margin-bottom: 20px; 
                font-size: 1.5em; 
                color: #333;
            ">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2>
            <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="
                width: 100%; 
                padding: 10px; 
                font-size: 1em; 
                margin-bottom: 15px; 
                border: 1px solid #ddd; 
                border-radius: 8px; 
                box-sizing: border-box;
            " />
            <button id="submitPassword" style="
                width: 100%; 
                padding: 10px; 
                font-size: 1em; 
                background: #007BFF; 
                color: white; 
                border: none; 
                border-radius: 8px; 
                cursor: pointer; 
                transition: background 0.3s ease;
            ">í™•ì¸</button>
        </div>
    `;

    document.body.appendChild(passwordModal);

    // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì´ë²¤íŠ¸
    document.getElementById("submitPassword").addEventListener("click", verifyPassword);

    // Enter í‚¤ ì…ë ¥ ì´ë²¤íŠ¸ ì¶”ê°€
    document.getElementById("passwordInput").addEventListener("keydown", (event) => {
        if (event.key === "Enter") { // Enter í‚¤ ì…ë ¥ í™•ì¸
            verifyPassword(); // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë¡œì§ í˜¸ì¶œ
        }
    });

    // âœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ ë°ì´í„° ë¡œë“œ
    function verifyPassword() {
        const inputPassword = document.getElementById("passwordInput").value;
        if (passwords.includes(inputPassword)) {
            document.body.removeChild(passwordModal); // ëª¨ë‹¬ ë‹«ê¸°

            // ğŸ”¥ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ì—ë§Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜´
            setTimeout(() => {
                loadDataFromLocalStorage();
                setupRealtimeUpdates();
                loadDataFromFirebase();
            }, 500);
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
        }
    }
};



        // ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì†Œë¦¬ ì¬ìƒ í™œì„±í™”
        enableSoundButton.addEventListener('click', () => {
            soundEnabled = true;
            playNotificationSound(); // ì†Œë¦¬ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
            enableSoundButton.style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        });

        // ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜: ì†Œë¦¬ê°€ ìë™ìœ¼ë¡œ ì¬ìƒë  ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬
        function playNotificationSound() {
            if (soundEnabled) {
                notificationSound.volume = 1.0; // ìµœëŒ€ ë³¼ë¥¨ ì„¤ì •
                notificationSound.currentTime = 0; // ì†Œë¦¬ë¥¼ ì²˜ìŒë¶€í„° ì¬ìƒ
                repeatSound(3); // ì†Œë¦¬ë¥¼ 3ë²ˆ ë°˜ë³µ ì¬ìƒ
            }
        }

        // ì†Œë¦¬ ë°˜ë³µ ì¬ìƒ í•¨ìˆ˜
        function repeatSound(repeatCount) {
            let playCount = 0;

            function playAgain() {
                if (playCount < repeatCount) {
                    notificationSound.play().then(() => {
                        playCount++;
                        notificationSound.onended = playAgain; // ì†Œë¦¬ê°€ ëë‚˜ë©´ ë‹¤ì‹œ ì¬ìƒ
                    }).catch(error => {
                        console.error("ì†Œë¦¬ ì¬ìƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    });
                }
            }

            playAgain(); // ì²« ì¬ìƒ í˜¸ì¶œ
        }

        // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        if (Notification.permission !== "granted") {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    console.log("ì•Œë¦¼ ê¶Œí•œ í—ˆìš©ë¨");
                }
            });
        }

        // ìƒˆë¡œìš´ ì£¼ë¬¸ ì•Œë¦¼ ìƒì„± í•¨ìˆ˜
        function showNotification() {
            if (Notification.permission === "granted") {
                const notification = new Notification("ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!", {
                    body: "í´ë¦­í•˜ì—¬ ì†Œë¦¬ë¥¼ ì¬ìƒí•˜ì„¸ìš”.",
                    icon: "notification_icon.png" // ì•Œë¦¼ ì•„ì´ì½˜ (ì›í•˜ëŠ” ì´ë¯¸ì§€ë¡œ êµì²´ ê°€ëŠ¥)
                });

                // ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ í´ë¦­í•˜ë©´ ì†Œë¦¬ ì¬ìƒ
                notification.onclick = () => {
                    playNotificationSound();
                    notification.close(); // ì•Œë¦¼ ë‹«ê¸°
                };

                // **ì•„ì´ì½˜ì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì•„ì´ì½˜ìœ¼ë¡œ ëŒ€ì²´**
                notification.onerror = () => {
                    console.warn("ì•Œë¦¼ ì•„ì´ì½˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì•„ì´ì½˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.");
                    const fallbackNotification = new Notification("ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!", {
                        body: "í´ë¦­í•˜ì—¬ ì†Œë¦¬ë¥¼ ì¬ìƒí•˜ì„¸ìš”.",
                        icon: "https://via.placeholder.com/50" // ê¸°ë³¸ ì•„ì´ì½˜ìœ¼ë¡œ ëŒ€ì²´
                    });

                    fallbackNotification.onclick = () => {
                        playNotificationSound();
                        fallbackNotification.close();
                    };
                };
            }
        }

        // Pront ìƒíƒœë¥¼ Local Storageì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function saveProntoState(key, isPronto) {
            let prontoState = JSON.parse(localStorage.getItem('prontoState')) || {};
            prontoState[key] = isPronto;
            localStorage.setItem('prontoState', JSON.stringify(prontoState));
        }

        // Pront ìƒíƒœë¥¼ Local Storageì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadProntoState(key) {
            let prontoState = JSON.parse(localStorage.getItem('prontoState')) || {};
            return prontoState[key] || false;
        }

        // ë°ì´í„°ë¥¼ Local Storageì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function saveDataToLocalStorage() {
            localStorage.setItem('firebaseData', JSON.stringify(allData));
        }

        // Local Storageì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadDataFromLocalStorage() {
            const storedData = localStorage.getItem('firebaseData');
            if (storedData) {
                allData = JSON.parse(storedData);
                allData.forEach(item => {
                    displayData(item.key, item.data);
                });
                populateDateFilter(); // ë‚ ì§œ í•„í„°ì— ê°’ ì¶”ê°€
            }
        }


    // ë°ì´í„°ë¥¼ í…Œì´ë¸”ë¡œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ (ìµœì¢… ì™„ì„±)
        function displayData(key, data) {
            // í…Œì´ë¸” ì„ íƒ: tableNumberê°€ 99ë©´ ì˜¤ë¥¸ìª½ í…Œì´ë¸”, ì•„ë‹ˆë©´ ì™¼ìª½ í…Œì´ë¸”
            const targetTableBody = Number(data.tableNumber) === 99 ? 
                document.querySelector('#deliveryTable tbody') : 
                document.querySelector('#dataTable tbody'); // ì˜¤ë¥¸ìª½ ë˜ëŠ” ì™¼ìª½ í…Œì´ë¸” ì„ íƒ

            const row = document.createElement('tr'); // ìƒˆë¡œìš´ í–‰ ìƒì„±

          

            // ê° ë°ì´í„° í•„ë“œë¥¼ ë³„ë„ë¡œ ê°€ì ¸ì˜¤ê¸°
            const number = count++; // ë°ì´í„° ë²ˆí˜¸ëŠ” 1ë¶€í„° ì‹œì‘í•˜ì—¬ ìƒˆë¡œ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ì¦ê°€
            const tableNumber = data.tableNumber || 'N/A'; // í…Œì´ë¸” ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ 'N/A'
            const timestamp = data.timestamp || 'N/A'; // íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ì—†ìœ¼ë©´ 'N/A'
            const dateObj = new Date(timestamp); // íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ Date ê°ì²´ë¡œ ë³€í™˜

            // âœ… ë‚ ì§œì—ì„œ ì—°ë„ (/2025) ì œê±°
    const date = dateObj.toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' }).split('/').slice(0, 2).join('/');

    // âœ… ì‹œê°„ì—ì„œ ì´ˆ (:58) ì œê±°
    const time = dateObj.toLocaleTimeString('pt-BR', { timeZone: 'America/Sao_Paulo', hour12: false }).split(':').slice(0, 2).join(':');

            let orderList = ''; // ì£¼ë¬¸ ëª©ë¡ ì´ˆê¸°í™”

            // ìƒˆë¡œìš´ ê¸°ëŠ¥: orderListê°€ ë°°ì—´ í˜•íƒœì¼ ê²½ìš° ì²˜ë¦¬
            if (data.orderList && Array.isArray(data.orderList)) {
                orderList = data.orderList
                    .map(item => `${item.name}: ${item.quantity}`) // nameê³¼ quantityë¥¼ í•œ ì¤„ë¡œ í‘œì‹œ
                    .join('<br>'); // ê° í•­ëª©ì„ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
            }

            // ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€: orderListê°€ ë¬¸ìì—´ í˜•íƒœì¼ ê²½ìš° ê¸°ì¡´ ì²˜ë¦¬ ë°©ì‹ ì ìš©
            orderList = data.orderList ? JSON.stringify(data.orderList) : ''; // ì£¼ë¬¸ ëª©ë¡ JSON ë¬¸ìì—´í™”
            orderList = orderList.replace(/[\[\]]/g, ''); // '[' ì™€ ']' ì œê±°
            orderList = orderList.replace(/."quantity"/g, ''); // "quantity" ì œê±°
            orderList = orderList.split('},{').join('},<br>{'); // '},{'ë§ˆë‹¤ ì¤„ë°”ê¿ˆì„ ìœ„í•´ <br> ì¶”ê°€

            // "name": íŒ¨í„´ ì œê±°
            orderList = orderList.replace(/"\s*name\s*":\s*"/g, '');

            // ë¶ˆí•„ìš”í•œ ê³µë°±ê³¼ ì¤‘ê´„í˜¸ ì œê±°
            orderList = orderList.replace(/{\s*/g, '{').replace(/\s*}/g, '}');
            orderList = orderList.replace(/{/g, '').replace(/}/g, '');

            // Name, Contact, Address í•„ë“œ ê°€ì ¸ì˜¤ê¸°
            const name = data.customerName || 'N/A'; // ì´ë¦„ì´ ì—†ìœ¼ë©´ 'N/A'
            const contact = data.customerContact || 'N/A'; // ì—°ë½ì²˜ê°€ ì—†ìœ¼ë©´ 'N/A'
            const address = data.customerAddress || 'N/A'; // ì£¼ì†Œê°€ ì—†ìœ¼ë©´ 'N/A'

            const totalAmount = data.totalAmount || 'N/A'; // ì´ ê¸ˆì•¡ì´ ì—†ìœ¼ë©´ 'N/A'

            
            // í‚¤ì›Œë“œ ë°°ì—´ ì •ì˜
            const blueKeywords = ['chicken', 'meia/meia', 'meia']; // íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œí•  í‚¤ì›Œë“œ
            const orangeKeywords = ['teokpoki', 'lapokki', 'batata', 'lamen']; // ì£¼í™©ìƒ‰ìœ¼ë¡œ í‘œì‹œí•  í‚¤ì›Œë“œ
            const yellowKeywords = [
                "Coca", "Coca Zero", "GuaranÃ¡", "Fanta Uva", "Fanta MaracujÃ¡",
                "Fanta Laranja", "Sprite", "Schweppes", "Soda Melancia", "Soda de MelÃ£o",
                "Bong Bong Uva", "Bong. Morango", "Ãgua", "H2Oh", "Valle Uva",
                "Valle PÃªssego", "Valle Goiaba", "Valle Manga", "Coca 600ml", 
                "Zero 600ml", "Original", "Heineken", "Soju", "Sou de Fruta"
            ].map(keyword => keyword.toLowerCase()); // ëª¨ë‘ ì†Œë¬¸ìë¡œ ë³€í™˜

            // íŠ¹ì • í‚¤ì›Œë“œë¥¼ í¬í•¨í•œ ì¤„ì— ìƒ‰ìƒì„ ì ìš©
            orderList = orderList
                .split('<br>') // ì¤„ì„ '<br>' ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                .map(line => {
                    // íŒŒë€ìƒ‰ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš°
                    if (blueKeywords.some(keyword => line.toLowerCase().includes(keyword))) {
                        return `<span style="color: red; font-weight: bold;">${line}</span>`; // ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ìŠ¤íƒ€ì¼ë§
                    }
                    // ì£¼í™©ìƒ‰ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš°
                    if (orangeKeywords.some(keyword => line.toLowerCase().includes(keyword))) {
                        return `<span style="color: green; font-weight: bold;">${line}</span>`; // ë…¹ìƒ‰ìœ¼ë¡œ ìŠ¤íƒ€ì¼ë§
                    }
                    // ë…¸ë€ìƒ‰ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš°
                    if (yellowKeywords.some(keyword => line.toLowerCase().includes(keyword))) {
                        return `<span style="color: blue; font-weight: bold;">${line}</span>`;  // íŒŒë€ìƒ‰ìœ¼ë¡œ ìŠ¤íƒ€ì¼ë§
                    }
                    return line; // ë‹¤ë¥¸ ì¤„ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
                })
                .join('<br>'); // ë‹¤ì‹œ ì¤„ë°”ê¿ˆìœ¼ë¡œ í•©ì¹¨

            // ìˆ˜ëŸ‰ ì¶”ì¶œ: ë”°ì˜´í‘œ ì•ˆì˜ ìˆ«ìë§Œ ì¶”ì¶œ
            const qtyMatches = orderList.match(/"\d+"/g); // ë”°ì˜´í‘œ ì•ˆì— ìˆëŠ” ìˆ«ìë§Œ ì¶”ì¶œ
            let qtyText = '';
            if (qtyMatches) {
                qtyText = qtyMatches.map(num => num.replace(/"/g, '')).join('<br>'); // ê° ìˆ«ìë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°í•˜ì—¬ í‘œì‹œ
            }

            // ê° í•„ë“œë¥¼ ì…€ë¡œ ë§Œë“¤ì–´ í…Œì´ë¸”ì— ì¶”ê°€
            const numberCell = document.createElement('td');
            const dateCell = document.createElement('td'); // Date ì…€
            const timestampCell = document.createElement('td'); // ì‹œê°„ë§Œ í‘œì‹œë˜ëŠ” ì…€
            const tableNumberCell = document.createElement('td');
            const orderListCell = document.createElement('td');
            const nameCell = document.createElement('td'); // ì´ë¦„ ì…€
            const contactCell = document.createElement('td'); // ì—°ë½ì²˜ ì…€
            const addressCell = document.createElement('td'); // ì£¼ì†Œ ì…€
            const qtyCell = document.createElement('td'); // Qty ì…€ ì¶”ê°€
            const totalAmountCell = document.createElement('td');
            const paymentCell = document.createElement('td'); // Payment ì…€
            const paymentMethod = data.paymentMethod || 'N/A'; // ê²°ì œ ë°©ì‹ì´ ì—†ìœ¼ë©´ 'N/A'
            paymentCell.textContent = paymentMethod; // Payment ê°’ì„ ì…€ì— ì¶”ê°€

            // Payment ì…€ì— ê°’ì´ ìˆì„ ê²½ìš° ë°°ê²½ìƒ‰ ë³€ê²½
            if (paymentMethod && paymentMethod !== 'N/A') {
                row.style.backgroundColor = '#d0e7ff'; // ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ì„ í–‰ ì „ì²´ì— ì ìš©
            }
            // í–‰ì— ë°ì´í„° í‚¤ ì¶”ê°€ (ëª¨ë‹¬ê³¼ ì—°ë™ ìœ„í•´)
                row.setAttribute('data-key', key);
            const actionCell = document.createElement('td'); // Action ì…€


            // ì™¼ìª½ í…Œì´ë¸”ì¸ì§€ í™•ì¸í•˜ì—¬ íŠ¹ì • ì…€ ìˆ¨ê¸°ê¸°
            if (targetTableBody === document.querySelector('#dataTable tbody')) {
                nameCell.style.display = 'none'; // ì´ë¦„ ì…€ ìˆ¨ê¹€
                contactCell.style.display = 'none'; // ì—°ë½ì²˜ ì…€ ìˆ¨ê¹€
                addressCell.style.display = 'none'; // ì£¼ì†Œ ì…€ ìˆ¨ê¹€
            }

           // Pront ë²„íŠ¼ ìƒì„±
            const prontButton = document.createElement('button');
            prontButton.innerHTML = '<i class="fas fa-check"></i>'; // ì²´í¬ ì•„ì´ì½˜
            prontButton.title = 'Pronto'; // ë²„íŠ¼ ì„¤ëª…
            prontButton.onclick = function() {
                row.style.backgroundColor = '#2F4F4F'; // Pront í´ë¦­ ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½
                saveProntoState(key, true); // Pronto ìƒíƒœ ì €ì¥
                database.ref(`orders/${key}`).update({ pronto: true }); // ğŸ”¥ Firebaseì— ì €ì¥ (í•œ ì¤„ ì¶”ê°€)
            };

            // Cancel ë²„íŠ¼ ìƒì„±
            const cancelButton = document.createElement('button');
            cancelButton.innerHTML = '<i class="fas fa-times"></i>'; // ì·¨ì†Œ ì•„ì´ì½˜
            cancelButton.title = 'Cancel'; // ë²„íŠ¼ ì„¤ëª…
            cancelButton.onclick = function() {
                row.style.backgroundColor = ''; // Cancel í´ë¦­ ì‹œ ë°°ê²½ìƒ‰ ì´ˆê¸°í™”
                saveProntoState(key, false); // Pronto ìƒíƒœ ì´ˆê¸°í™”
                database.ref(`orders/${key}`).update({ pronto: false }); // ğŸ”¥ Firebaseì— ì €ì¥ (í•œ ì¤„ ì¶”ê°€)
            };

            // Print ë²„íŠ¼ ìƒì„±
            const printButton = document.createElement('button');
            printButton.innerHTML = '<i class="fas fa-print"></i>'; // í”„ë¦°í„° ì•„ì´ì½˜
            printButton.title = 'Print'; // ë²„íŠ¼ ì„¤ëª…
            printButton.onclick = function() {
                printReceipt(data); // Print ë²„íŠ¼ í´ë¦­ ì‹œ ì˜ìˆ˜ì¦ ì¸ì‡„
            };

            // Delete ë²„íŠ¼ ìƒì„±
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<i class="fas fa-trash"></i>'; // íœ´ì§€í†µ ì•„ì´ì½˜
            deleteButton.title = 'Delete'; // ë²„íŠ¼ ì„¤ëª…
            deleteButton.onclick = function () {
                deleteRow(row, key); // Delete ë²„íŠ¼ í´ë¦­ ì‹œ í–‰ ì‚­ì œ
            };


            // í…Œì´ë¸” í–‰ ë° Firebaseì—ì„œ ë°ì´í„° ì‚­ì œ
        function deleteRow(row, key) {
            // Firebaseì—ì„œ ë°ì´í„° ì‚­ì œ
            const isPronto = loadProntoState(key); // Pronto ìƒíƒœ í™•ì¸

        if (isPronto) {
            // Pronto ìƒíƒœë¼ë©´ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ìš”êµ¬
            const password = prompt('Pronto ìƒíƒœì…ë‹ˆë‹¤. ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '1127') { // ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return; // ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦¬ë©´ ì‚­ì œ ì¤‘ë‹¨
            }
        }

        // Firebaseì—ì„œ ë°ì´í„° ì‚­ì œ
        const dbRef = database.ref('orders').child(key);
        dbRef.remove()
            .then(() => {
                row.parentNode.removeChild(row); // í–‰ ì‚­ì œ
                allData = allData.filter(item => item.key !== key); // ë¡œì»¬ ë°ì´í„°ì—ì„œë„ ì‚­ì œ
                saveDataToLocalStorage();
                recalculateTotals();
                alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            })
            .catch((error) => {
                console.error('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ë§¤ì¶œ í•©ê³„ë¥¼ ì¬ê³„ì‚°í•˜ê³  UI ì—…ë°ì´íŠ¸
        function recalculateTotals() {
            let dailyTotalAmount = 0;
            let monthlyTotalAmount = 0;

            const today = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            const currentMonth = today.split('/')[1] + '/' + today.split('/')[2];

            allData.forEach(item => {
                const totalAmountText = item.data.totalAmount || '0';
                const totalAmount = parseFloat(totalAmountText.replace(/[^0-9.-]+/g, '')) || 0;
                const itemDate = new Date(item.data.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
                const itemMonth = itemDate.split('/')[1] + '/' + itemDate.split('/')[2];

                if (itemDate === today) {
                    dailyTotalAmount += totalAmount;
                }
                if (itemMonth === currentMonth) {
                    monthlyTotalAmount += totalAmount;
                }
            });

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('dailyTotal').textContent = `ì¼ ë§¤ì¶œ: ${dailyTotalAmount.toLocaleString('ko-KR')} ì›`;
            document.getElementById('monthlyTotal').textContent = `ì›” ë§¤ì¶œ: ${monthlyTotalAmount.toLocaleString('ko-KR')} ì›`;
        }
            // Pront, Cancel, Print, Delete ë²„íŠ¼ ì¶”ê°€
            actionCell.appendChild(prontButton);
            actionCell.appendChild(cancelButton);
            actionCell.appendChild(printButton);
            actionCell.appendChild(deleteButton);

            // ì…€ì— ê°’ ì¶”ê°€
            numberCell.textContent = number; // ë²ˆí˜¸ í‘œì‹œ
            dateCell.textContent = date; // ë‚ ì§œ í‘œì‹œ
            timestampCell.textContent = time; // ì‹œê°„ í‘œì‹œ
            tableNumberCell.textContent = tableNumber; // í…Œì´ë¸” ë²ˆí˜¸ í‘œì‹œ
            orderListCell.innerHTML = orderList; // ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ
            nameCell.textContent = name; // ì´ë¦„ í‘œì‹œ
            contactCell.textContent = contact; // ì—°ë½ì²˜ í‘œì‹œ
            addressCell.textContent = address; // ì£¼ì†Œ í‘œì‹œ
            qtyCell.innerHTML = qtyText; // ìˆ˜ëŸ‰ í‘œì‹œ
            totalAmountCell.textContent = totalAmount.replace(/Total:\s?/g, '').replace(/R\$\s?/g, ''); 


            // í–‰ì— ì…€ ì¶”ê°€
            row.appendChild(numberCell);
            row.appendChild(dateCell);
            row.appendChild(timestampCell);
            row.appendChild(tableNumberCell);
            row.appendChild(orderListCell);
            row.appendChild(qtyCell); // ìˆ˜ëŸ‰ ì…€ ì¶”ê°€
            row.appendChild(totalAmountCell);
            row.appendChild(paymentCell); // Payment ì…€ ì¶”ê°€
            row.appendChild(nameCell); // ì´ë¦„ ì…€ ì¶”ê°€
            row.appendChild(contactCell); // ì—°ë½ì²˜ ì…€ ì¶”ê°€
            row.appendChild(addressCell); // ì£¼ì†Œ ì…€ ì¶”ê°€
            row.appendChild(actionCell); // Action ì…€ ì¶”ê°€


            // Pront ìƒíƒœì— ë”°ë¼ ë°°ê²½ìƒ‰ ì ìš©
            if (loadProntoState(key)) {
                row.style.backgroundColor = '#008000'; // ì¼ì •í•œ ë…¹ìƒ‰ ìœ ì§€
            }

            // ì„ íƒëœ í…Œì´ë¸”ì— í–‰ ì¶”ê°€
            targetTableBody.insertBefore(row, targetTableBody.firstChild);
        }


       // ì˜ìˆ˜ì¦ ì¸ì‡„ í•¨ìˆ˜
function printReceipt(data) {
    // orderListì—ì„œ "name:"ê³¼ ë¶ˆí•„ìš”í•œ ë¬¸ì ì œê±°
    let orderListFormatted = (data.orderList || [])
        .map(item => {
            if (typeof item === "object") {
                return `${item.quantity}x ${item.name}`; // ì˜ˆ: "2x Chicken"
            }
            return item; // ì´ë¯¸ ë¬¸ìì—´ í˜•íƒœë¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
        })
        .join('<br>'); // ì¤„ë°”ê¿ˆ ì¶”ê°€

    // ì¶œë ¥í•  ë‚´ìš©ì„ HTML í˜•ì‹ìœ¼ë¡œ êµ¬ì„±
    const receiptContent = `
        <div style="font-size: 12px; line-height: 1; padding: 1px;">
            <h3 style="text-align: center;">Seoul Chicken Receipt</h3>
            <p><strong>Table Number:</strong> ${data.tableNumber || ''}</p>
            <p><strong>Date:</strong> ${new Date(data.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' })}</p>
            <p><strong>Time:</strong> ${new Date(data.timestamp).toLocaleTimeString('pt-BR', { timeZone: 'America/Sao_Paulo' })}</p>
            <p><strong>Order List:</strong></p>
            <p>${orderListFormatted}</p>
            <p style="margin: 0 0 10px 0;"><strong>Total Amount:</strong> ${data.totalAmount || ''}</p>
        </div>
    `;

    // ìƒˆ ì°½ì—ì„œ ì¶œë ¥ ì¤€ë¹„
    const printWindow = window.open('', '', 'height=500,width=400');
    printWindow.document.write(`
        <html>
        <head>
            <title>Receipt</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    margin: 0;
                    padding: 0;
                }
                div {
                    width: 80mm; /* ì˜ìˆ˜ì¦ í­ */
                    font-size: 12px;
                    line-height: 1.5;
                }
                @media print {
                    body {
                        margin: 0;
                        padding: 0;
                    }
                    div {
                        page-break-after: avoid; /* í˜ì´ì§€ ë‚˜ëˆ„ê¸° ë°©ì§€ */
                        margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ */
                        padding: 10px;
                        width: 100%; /* ì¸ì‡„ ê°€ëŠ¥í•œ ì˜ì—­ ì‚¬ìš© */
                        box-sizing: border-box;
                        margin: 0 0 30px 0; /* ì•„ë˜ìª½ì— 10px ì—¬ë°± ì¶”ê°€ */
                    }
                }
            </style>
        </head>
        <body>
            ${receiptContent}
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
}

    

       // Firebaseì—ì„œ ê¸°ì¡´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì‹œê°„ ì—­ìˆœìœ¼ë¡œ í‘œì‹œ)
function loadDataFromFirebase() {
    const dbRef = database.ref('orders'); // ë°ì´í„°ê°€ ì €ì¥ëœ ì •í™•í•œ ê²½ë¡œë¡œ ì„¤ì •
    dbRef.once('value', (snapshot) => {
        const data = snapshot.val();
        const sortedKeys = Object.keys(data).sort((a, b) => new Date(data[b].timestamp) - new Date(data[a].timestamp)); // íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ì¤€ìœ¼ë¡œ ì—­ìˆœ ì •ë ¬

        let dailyTotalAmount = 0; // ì¼ ë§¤ì¶œ ì´ˆê¸°í™”
        let monthlyTotalAmount = 0; // ì›” ë§¤ì¶œ ì´ˆê¸°í™”
        const today = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        const currentMonth = today.split('/')[1] + '/' + today.split('/')[2]; // í˜„ì¬ ì›” (MM/YYYY)

        sortedKeys.forEach((key) => {
            if (!allData.some(item => item.key === key)) {
                allData.push({ key, data: data[key] });
                displayData(key, data[key]);

                // Total Amount í•©ê³„ ê³„ì‚°   
                const totalAmountText = data[key].totalAmount || '0'; // null ë˜ëŠ” undefinedì¼ ê²½ìš° ê¸°ë³¸ê°’ 0 ì„¤ì •
                const totalAmount = parseFloat(totalAmountText.replace(/[^0-9.-]+/g, '')) || 0; // ìˆ«ì ì´ì™¸ì˜ ë¬¸ì ì œê±°
                const itemDate = new Date(data[key].timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' }); // ë¸Œë¼ì§ˆ ì‹œê°„ëŒ€ì™€ í¬ë§· ì ìš©
                const itemMonth = itemDate.split('.')[0] + '.' + itemDate.split('.')[1]; // ì—°ë„ì™€ ì›”ë§Œ ì¶”ì¶œ

                if (itemDate === today) {
                    dailyTotalAmount += totalAmount; // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì´ ê¸ˆì•¡
                }
                if (itemMonth === currentMonth) {
                    monthlyTotalAmount += totalAmount; // í˜„ì¬ ì›”ì˜ ì´ ê¸ˆì•¡
                }
            }
        });

        // ì¼ ë§¤ì¶œ ë° ì›” ë§¤ì¶œ ì—…ë°ì´íŠ¸
        document.getElementById('dailyTotal').textContent = `ì¼ ë§¤ì¶œ: ${dailyTotalAmount.toLocaleString('ko-KR')} ì›`;
        document.getElementById('monthlyTotal').textContent = `ì›” ë§¤ì¶œ: ${monthlyTotalAmount.toLocaleString('ko-KR')} ì›`;

        saveDataToLocalStorage(); // ë°ì´í„°ë¥¼ Local Storageì— ì €ì¥
        populateDateFilter(); // ë‚ ì§œ í•„í„°ì— ê°’ ì¶”ê°€
    });
}

       

        // ë‚ ì§œ í•„í„° ë“œë¡­ë‹¤ìš´ì„ ì±„ìš°ëŠ” í•¨ìˆ˜
        function populateDateFilter() {
        // ê¸°ì¡´ í•„í„° ì˜µì…˜ ì´ˆê¸°í™”
        dateFilter.innerHTML = ''; 

        // "All Dates" ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€
        const allOption = document.createElement('option');
        allOption.value = 'all';
        allOption.textContent = 'All Dates';
        dateFilter.appendChild(allOption);

        // ì¤‘ë³µ ì—†ëŠ” ë‚ ì§œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        const uniqueDates = [...new Set(allData.map(item =>
            new Date(item.data.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' })
        ))];

        // ë‚ ì§œ ì˜µì…˜ ì¶”ê°€
        uniqueDates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = date;
            dateFilter.appendChild(option);
        });
    }

        // ë‚ ì§œ í•„í„°ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        dateFilter.addEventListener('change', function() {
            const selectedDate = dateFilter.value;
            filterDataByDate(selectedDate);
        });

 // âœ… ë°ì´í„° í•„í„°ë§ í•¨ìˆ˜ (ì„ íƒí•œ ë‚ ì§œì— ë”°ë¼ í…Œì´ë¸” ë°ì´í„° í•„í„°ë§)
    function filterDataByDate(date) {
        tableBody.innerHTML = ''; // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
        deliveryTableBody.innerHTML = ''; // ë°°ë‹¬ í…Œì´ë¸” ì´ˆê¸°í™”
        count = 1; // ì¹´ìš´í„° ì´ˆê¸°í™”

        let dailyTotalAmount = 0; // ì¼ ë§¤ì¶œ
        let monthlyTotalAmount = 0; // ì›” ë§¤ì¶œ

        const today = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        const currentMonth = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' }).split('/')[1];

        allData.forEach(item => {
            const itemDateObj = new Date(item.data.timestamp);
            const itemDate = itemDateObj.toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            const itemMonth = itemDateObj.getMonth() + 1;
            const itemYear = itemDateObj.getFullYear();
            const totalAmountText = item.data.totalAmount || '0';
            const totalAmount = parseFloat(totalAmountText.replace(/[^0-9.-]+/g, '')) || 0;

            if (date === 'all' || date === itemDate) {
                displayData(item.key, item.data);
            }

            if (itemDate === today) {
                dailyTotalAmount += totalAmount;
            }

            if (itemMonth == currentMonth && itemYear == new Date().getFullYear()) {
                monthlyTotalAmount += totalAmount;
            }
        });

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('dailyTotal').textContent = `ì¼ ë§¤ì¶œ: ${dailyTotalAmount.toLocaleString('ko-KR')} ì›`;
        document.getElementById('monthlyTotal').textContent = `ì›” ë§¤ì¶œ: ${monthlyTotalAmount.toLocaleString('ko-KR')} ì›`;
    }

    // âœ… Firebaseì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì²˜ë¦¬
    function setupRealtimeUpdates() {
        const dbRef = database.ref('orders');

        // âœ… ìƒˆë¡œìš´ ì£¼ë¬¸ ì¶”ê°€ ê°ì§€
        dbRef.on('child_added', (snapshot) => {
            const newData = { key: snapshot.key, data: snapshot.val() };

            if (!allData.some(item => item.key === newData.key)) {
                allData.push(newData);

                if (dateFilter.value === 'all' || new Date(newData.data.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' }) === dateFilter.value) {
                    displayData(newData.key, newData.data);
                }

                saveDataToLocalStorage();
                updateSales(newData.data);
            }

            updateDateFilter(newData.data.timestamp);
            showNotification();
        });

        // âœ… ì£¼ë¬¸ ë³€ê²½ ê°ì§€ (ê²°ì œ ì •ë³´ ë° pronto ìƒíƒœ ë°˜ì˜)
        dbRef.on('child_changed', (snapshot) => {
            const updatedKey = snapshot.key;
            const updatedData = snapshot.val();

            document.querySelectorAll('#dataTable tbody tr, #deliveryTable tbody tr').forEach(row => {
                if (row.getAttribute('data-key') === updatedKey) {
                    // ê²°ì œ ì •ë³´ ì—…ë°ì´íŠ¸
                    const paymentCell = row.children[7];
                    if (updatedData.paymentMethod) {
                        paymentCell.textContent = updatedData.paymentMethod;
                        paymentCell.style.backgroundColor = '#d0e7ff';
                    }

                    // Pronto ìƒíƒœ ì—…ë°ì´íŠ¸
                    row.style.backgroundColor = updatedData.pronto ? '#2F4F4F' : '';
                }
            });
        });
    }

    // âœ… ê²°ì œ ì •ë³´ ì €ì¥ ë° Firebase ì—…ë°ì´íŠ¸
    function submitPayment() {
        const paymentMethod = document.getElementById('paymentMethod').value;
        const modalTitle = document.getElementById('modalTitle').textContent;
        const tableNumber = parseInt(modalTitle.replace('Table ', '').replace(' Details', ''), 10);

        const dbRef = firebase.database().ref('orders');
        dbRef.once('value', (snapshot) => {
            const data = snapshot.val();
            const targetKey = Object.keys(data || {}).find(key => Number(data[key].tableNumber) === tableNumber);

            if (targetKey) {
                dbRef.child(targetKey).update({ paymentMethod }).then(() => {
                    alert('ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeModal();
                }).catch((error) => {
                    console.error('ê²°ì œ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
                });
            } else {
                alert('í•´ë‹¹ í…Œì´ë¸” ë²ˆí˜¸ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        });
    }

    // âœ… ë‚ ì§œ í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateDateFilter(timestamp) {
        const newDate = new Date(timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        if (!Array.from(dateFilter.options).some(option => option.value === newDate)) {
            const option = document.createElement('option');
            option.value = newDate;
            option.textContent = newDate;
            dateFilter.appendChild(option);
        }
    }

    // âœ… ìƒˆ ì£¼ë¬¸ì´ ë“¤ì–´ì˜¬ ë•Œ ë§¤ì¶œ ìë™ ì—…ë°ì´íŠ¸
    function updateSales(newData) {
        const today = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        const currentMonth = today.split('/')[1];

        let dailyTotalAmount = parseFloat(document.getElementById('dailyTotal').textContent.replace(/[^0-9.-]+/g, '')) || 0;
        let monthlyTotalAmount = parseFloat(document.getElementById('monthlyTotal').textContent.replace(/[^0-9.-]+/g, '')) || 0;

        const totalAmountText = newData.totalAmount || '0';
        const totalAmount = parseFloat(totalAmountText.replace(/[^0-9.-]+/g, '')) || 0;
        const itemDate = new Date(newData.timestamp).toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        const itemMonth = new Date(newData.timestamp).getMonth() + 1;

        if (itemDate === today) {
            dailyTotalAmount += totalAmount;
        }

        if (itemMonth == currentMonth) {
            monthlyTotalAmount += totalAmount;
        }

        document.getElementById('dailyTotal').textContent = `ì¼ ë§¤ì¶œ: ${dailyTotalAmount.toLocaleString('ko-KR')} ì›`;
        document.getElementById('monthlyTotal').textContent = `ì›” ë§¤ì¶œ: ${monthlyTotalAmount.toLocaleString('ko-KR')} ì›`;
    }

    // âœ… ì£¼ë¬¸ ì‚­ì œ ì²˜ë¦¬
    function deleteRow(row, key) {
        const isPronto = loadProntoState(key);

        if (isPronto) {
            const password = prompt('Pronto ìƒíƒœì…ë‹ˆë‹¤. ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '1127') {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
        }

        const dbRef = database.ref('orders').child(key);
        dbRef.remove()
            .then(() => {
                row.parentNode.removeChild(row);
                allData = allData.filter(item => item.key !== key);
                saveDataToLocalStorage();
                alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            })
            .catch((error) => {
                console.error('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
    }

    // âœ… Local Storageì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    function loadDataFromLocalStorage() {
        const storedData = localStorage.getItem('firebaseData');
        if (storedData) {
            allData = JSON.parse(storedData);
            allData.forEach(item => {
                displayData(item.key, item.data);
            });
            populateDateFilter();
        }
    }

    </script>
</body>
</html>
